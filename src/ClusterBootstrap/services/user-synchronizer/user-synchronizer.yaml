apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: user-synchronizer-cronjob
spec:
  concurrencyPolicy: Forbid
  jobTemplate:
    metadata:
      name: user-synchronizer-job
    spec:
      template:
        metadata:
          name: user-synchronizer-pod
        spec:
          containers:
          - name: user-synchronizer
            image: '{{cnf["worker-dockerregistry"]}}{{cnf["dockerprefix"]}}user-synchronizer:{{cnf["dockertag"]}}'
            imagePullPolicy: Always
            env:
            - name: TENANT_ID
              value: '{{cnf["activeDirectory"]["tenant_id"]}}'
            - name: CLIENT_ID
              value: '{{cnf["activeDirectory"]["client_id"]}}'
            - name: CLIENT_SECRET
              value: '{{cnf["activeDirectory"]["client_secret"]}}'
            - name: WINBIND_URL
              value: '{{cnf["WinbindServers"]}}'
            - name: RESTFULAPI_URL
              value: '{{cnf["restapi"]}}'
          nodeSelector:
            user-synchronizer: active
          restartPolicy: Never
          tolerations:
            - key: node-role.kubernetes.io/master
              effect: NoSchedule
  schedule: '0 * * * *'
