@{
    ViewData["Title"] = "View Your Submitted Job";
}

<h1>View Your Jobs:</h1>


<script src="http://ajax.microsoft.com/ajax/jquery/jquery-1.10.2.min.js" type="text/javascript"></script>

<script type="text/javascript">
    function KillJob(jobId) {
        $.getJSON("@ViewData["restapi"]/KillJob?jobId=" + jobId,
        function (json) {
            alert(json.result);
        });
    }
</script>

<script>
    function buildTable() {
        //username = "@User.Identity.Name".replace("REDMOND", "")
        console.log("===============")
        console.log(username)
        console.log("===============")
        var apiurl = "@ViewData["restapi"]/ListJobs?userName=" + username;
        console.log(apiurl)

        $.ajax({
            url: apiurl,
            dataType: 'json',
            timeout: 10000 //10 second timeout,

        }).done(
        function (json) {
            $("#running-job-table").find("tr:gt(0)").remove();
            var tr;
            //Append each row to html table
            for (var i = 0; i < json.runningJobs.length; i++) {
                tr = $('<tr/>');
                tr.append("<td> <a href='/Home/JobDetail/?jobId=" + json.runningJobs[i].jobId + "'>" + json.runningJobs[i].jobId + "</a></td>");
                tr.append("<td>" + json.runningJobs[i].jobName + "</td>");
                tr.append("<td>" + json.runningJobs[i].jobStatus + "</td>");
                tr.append("<td>" + json.runningJobs[i].jobParams.resourcegpu + "</td>");
                tr.append("<td>" + json.runningJobs[i].userName + "</td>");
                tr.append("<td>" + json.runningJobs[i].jobTime.toString("YYYYMMDD") + "</td>");
                tr.append("<td> <a href='#'  onclick=\"KillJob('" + json.runningJobs[i].jobId + "')\" > kill </a></td>");
                $('#running-job-table').append(tr);
            }

            $("#finished-job-table").find("tr:gt(0)").remove();
            if (json.finishedJobs.length <= 0) {
                $('#finished-job').hide();
            }
            else {
                var tr;
                $('#finished-job').show();
                //Append each row to html table
                for (var i = 0; i < json.finishedJobs.length; i++) {
                    tr = $('<tr/>');
                    tr.append("<td> <a href='/Home/JobDetail/?jobId=" + json.finishedJobs[i].jobId + "'>" + json.finishedJobs[i].jobId + "</a></td>");
                    tr.append("<td>" + json.finishedJobs[i].jobName + "</td>");
                    tr.append("<td>" + json.finishedJobs[i].jobStatus + "</td>");
                    tr.append("<td>" + json.finishedJobs[i].jobParams.resourcegpu + "</td>");
                    tr.append("<td>" + json.finishedJobs[i].userName + "</td>");
                    tr.append("<td>" + json.finishedJobs[i].jobTime + "</td>");
                    $('#finished-job-table').append(tr);
                }
            }


            $("#queued-job-table").find("tr:gt(0)").remove();
            if (json.queuedJobs.length <= 0) {
                $('#queued-job').hide();

            }
            else {
                $('#queued-job').show()
                var tr;
                //Append each row to html table
                for (var i = 0; i < json.queuedJobs.length; i++) {
                    tr = $('<tr/>');
                    tr.append("<td> <a href='/Home/JobDetail/?jobId=" + json.queuedJobs[i].jobId + "'>" + json.queuedJobs[i].jobId + "</a></td>");
                    tr.append("<td>" + json.queuedJobs[i].jobName + "</td>");
                    tr.append("<td>" + json.queuedJobs[i].jobStatus + "</td>");
                    tr.append("<td>" + json.queuedJobs[i].jobParams.resourcegpu + "</td>");
                    tr.append("<td>" + json.queuedJobs[i].userName + "</td>");
                    tr.append("<td>" + json.queuedJobs[i].jobTime + "</td>");
                    tr.append("<td> <a href='#'  onclick=\"KillJob('" + json.queuedJobs[i].jobId + "')\" > kill </a></td>");
                    $('#queued-job-table').append(tr);
                }
            }


            $("#visualization-job-table").find("tr:gt(0)").remove();
            if (json.visualizationJobs.length <= 0) {
                $('#visualization-job').hide();

            }
            else {
                $('#visualization-job').show()
                var tr;
                //Append each row to html table
                for (var i = 0; i < json.visualizationJobs.length; i++) {
                    tr = $('<tr/>');
                    tr.append("<td> <a href='/Home/JobDetail/?jobId=" + json.visualizationJobs[i].jobId + "'>" + json.visualizationJobs[i].jobId + "</a></td>");
                    tr.append("<td>" + json.visualizationJobs[i].jobName + "</td>");
                    tr.append("<td>" + json.visualizationJobs[i].jobStatus + "</td>");
                    tr.append("<td>" + json.visualizationJobs[i].jobParams.resourcegpu + "</td>");
                    tr.append("<td>" + json.visualizationJobs[i].userName + "</td>");
                    tr.append("<td>" + json.visualizationJobs[i].jobTime + "</td>");
                    tr.append("<td> <a href='#'  onclick=\"KillJob('" + json.visualizationJobs[i].jobId + "')\" > kill </a></td>");

                    $('#visualization-job-table').append(tr);
                }
            }


        });
    }

    $(document).ready(function () {
        buildTable();
        var refresh = setInterval(function () {
            buildTable();
        }, 5000);
    });

</script>

<div id="queued-job" hidden>
    <p> <b>Queued Jobs</b></p>
    <table id="queued-job-table" class="table table-bordered table-condensed table-hover table-striped">
        <thead>
            <tr>
                <th>Job Id</th>
                <th>Job Name</th>
                <th>Status</th>
                <th>GPU</th>
                <th>User Name</th>
                <th>Job Submission Time</th>
                <th>Kill it</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>

<p> <b>Running Jobs</b></p>
<table id="running-job-table" class="table table-bordered table-condensed table-hover table-striped">
    <thead>
        <tr>
            <th>Job Id</th>
            <th>Job Name</th>
            <th>Status</th>
            <th>GPU</th>
            <th>User Name</th>
            <th>Job Submission Time</th>
            <th>Kill it</th>
        </tr>
    </thead>
    <tbody></tbody>
</table>

<div id="visualization-job" hidden>
    <p> <b>Visualization Jobs</b></p>
    <table id="visualization-job-table" class="table table-bordered table-condensed table-hover table-striped">
        <thead>
            <tr>
                <th>Job Id</th>
                <th>Job Name</th>
                <th>Status</th>
                <th>GPU</th>
                <th>User Name</th>
                <th>Job Submission Time</th>
                <th>Kill it</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>


<div id="finished-job" hidden>

    <p> <b>Finished Jobs</b></p>
    <table id="finished-job-table" class="table table-bordered table-condensed table-hover table-striped">
        <thead>
            <tr>
                <th>Job Id</th>
                <th>Job Name</th>
                <th>Status</th>
                <th>GPU</th>
                <th>User Name</th>
                <th>Job Submission Time</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>
</div>
